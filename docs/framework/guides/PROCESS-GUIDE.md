# 流程指南：特性規格框架

**目的**：實施 ISO 26262 + ASPICE 框架的團隊詳細流程說明  
**對象**：流程經理、技術主管、品質保證工程師  
**版本**：1.0.0

---

## 流程概述

特性規格框架建立了結構化、可追蹤的方法來開發符合以下標準的安全關鍵特性(SSD 控制器組件)：

- **ISO 26262-1:2018** - 汽車電氣/電子系統的函數安全性
- **ASPICE CL3** - 汽車軟體流程改進與能力評估(能力等級 3)

### 七階段特性開發生命週期

```
第 1 階段：初始化
  ↓
第 2 階段：需求分析
  ↓
第 3 階段：架構與設計
  ↓
第 4 階段：安全性分析
  ↓
第 5 階段：實施與驗證
  ↓
第 6 階段：審查與批准
  ↓
第 7 階段：基線與發佈
```

---

## 流程細節

### 第 1 階段：特性初始化 (1-2 天)

**目標**：確立特性範圍、ASIL 等級和專案結構

**輸入**：
- 危害分析和風險評估 (HARA) 輸出
- 產品需求
- 客戶規格

**活動**：

1. **定義特性範圍**
   - 此特性要解決什麼危害或需求？
   - 範圍內外涵蓋什麼？
   - 與其他特性有任何相依性嗎？

2. **確定 ASIL 等級**
   - 從 HARA 分析：嚴重性 × 曝光度 × 可控性
   - ASIL A (最低) → D (最高)
   - SSD 安全特性通常為 ASIL-B/C

3. **分配責任人**
   - 特性所有者(技術主管)
   - 需求負責人
   - 硬體負責人(若有硬體組件)
   - 軟體負責人(若有韌體組件)
   - 安全經理
   - 測試負責人

4. **建立特性結構**
   ```powershell
   .\create-feature.ps1 -Name "特性名稱" -ASIL "B" -Type "System"
   ```

**輸出**：
- 包含所有範本的特性目錄
- 已分配特性 ID
- 初始特性概述

**審查關卡**：特性啟動審查
- 利害關係人確認範圍和 ASIL
- 資源配置已批准
- 進度表已同意

---

### 第 2 階段：需求分析 (3-5 天)

**目標**：建立完整、可追蹤的需求階層

**活動**：

1. **定義安全目標 (SG)**
   - 從危害出發：需要實現什麼安全成果？
   - 範本：[REQUIREMENTS-TEMPLATE.md](../templates/REQUIREMENTS-TEMPLATE.md)
   - 需要利害關係人審查

2. **衍生函數安全需求 (FSR)**
   - 什麼功能能力可實現安全目標？
   - 多個 FSR 可能實現一個 SG
   - 記錄類型(檢測/預防/減輕/復原)

3. **開發系統需求 (SYS-REQ)**
   - 系統必須做什麼才能實現 FSR？
   - 功能範圍、介面、限制條件
   - 驗收標準(可測量)

4. **配置技術安全需求 (TSR)**
   - TSR-HW：負責的硬體組件
   - TSR-SW：負責的軟體/韌體模組
   - 每個 SYS-REQ → TSR-HW 和/或 TSR-SW

5. **建立雙向可追蹤性**
   - 正向：SG → FSR → SYS-REQ → TSR
   - 反向：TSR → SYS-REQ → FSR → SG
   - 使用可追蹤性矩陣範本

**關鍵原則**：每個需求都具有 ASIL 意識且可驗證

```markdown
SYS-REQ-001-001：電源檢測
- 衍生自：FSR-001-01 (檢測電源喪失)
- ASIL：B (繼承自 SG)
- 驗收標準：檢測延遲 < 1ms
- 驗證方法：測試 + 分析
```

**輸出**：
- requirements.md (完整的 SG/FSR/SYS-REQ/TSR 階層)
- traceability.md (初始可追蹤性矩陣)
- 已記錄的架構決策

**審查關卡**：需求審查
- 檢查清單：
  - [ ] 所有需求清楚明確
  - [ ] 所有需求可追蹤(正向和反向)
  - [ ] 所有驗收標準客觀且可測量
  - [ ] ASIL 等級正確
  - [ ] 需求之間無矛盾
  - [ ] HARA 中的所有危害已解決
- 批准：技術主管 + 安全經理

---

### 第 3 階段：架構與設計 (4-7 天)

**目標**：將需求分解為可實施的設計

**活動**：

1. **系統架構設計**
   - 方塊圖顯示組件和互動
   - 介面規格(電氣、邏輯、時序)
   - 需求分配給各組件

2. **硬體架構 (如適用)**
   - RTL 模組分解
   - 模組間介面
   - 時序分析(關鍵路徑)
   - 設計可測試性 (DFT) 特性

3. **軟體架構 (如適用)**
   - 模組/函式分解
   - 資料結構和演算法
   - 狀態機(如適用)
   - 資源預算(記憶體、CPU、時序)

4. **詳細設計**
   - 邏輯/演算法虛擬碼
   - 時序驗證(WCET 分析)
   - 安全機制實施細節
   - 錯誤處理策略

5. **設計至需求的映射**
   - 驗證每個需求都有設計實施
   - 維護可追蹤性連結

**輸出**：
- architecture.md
- detailed-design.md
- 時序分析報告
- 設計審查記錄

**審查關卡**：設計審查
- 檢查清單：
  - [ ] 架構涵蓋所有需求
  - [ ] 時序限制得到滿足
  - [ ] 安全機制設計恰當
  - [ ] 設計可測試
  - [ ] 設計品質可接受(ASPICE SWE.2, HWE.2)
- 批准：技術主管 + 架構師

---

### 第 4 階段：安全性分析 (3-5 天)

**目標**：識別和減輕失效模式

**活動**：

1. **FMEA (失效模式與影響分析)**
   - 識別所有潛在失效模式
   - 評估嚴重性/發生/檢測 (SOD)
   - 計算風險優先數 (RPN)
   - 為高 RPN 項目提議減輕方案
   - 範本：[SAFETY-ANALYSIS-TEMPLATE.md](../templates/SAFETY-ANALYSIS-TEMPLATE.md)

2. **FTA (故障樹分析)**
   - 定義頂級不良事件
   - 建立顯示因果關係的故障樹
   - 識別最小割集
   - 計算頂級事件的概率

3. **DFA (相關失效分析)**
   - 識別共同原因失效 (CCF)
   - 分析連鎖失效情景
   - 開發相關失效的減輕方案

4. **可追蹤性：安全性分析 → 需求**
   - 每個 FMEA 減輕方案 → 實施需求
   - 範例："雙冗餘檢測器" → TSR-HW-001-001

**輸出**：
- fmea.md (帶減輕方案的失效模式)
- fta.md (故障樹和概率分析)
- dfa.md (共同原因和連鎖失效)

**審查關卡**：安全性分析審查
- 檢查清單：
  - [ ] 所有失效模式已識別
  - [ ] RPN 計算正確
  - [ ] 高 RPN 項目有已記錄的減輕方案
  - [ ] 減輕方案可追蹤到需求
  - [ ] 共同原因失效已分析
  - [ ] 剩餘風險對 ASIL 等級可接受
- 批准：安全經理 + 技術主管

---

### 第 5 階段：實施與驗證 (8-14 天)

**目標**：實施設計並驗證正確性

**活動**：

1. **實施**
   - 硬體：Verilog/SystemVerilog 中的 RTL 代碼
   - 韌體：符合 MISRA C:2012 的 C 代碼
   - 在代碼中維護可追蹤性標籤：`@requirement TSR-HW-001-001`

2. **單元驗證 (ASPICE SWE.4, HWE.4)**
   - 硬體：UVM 測試平台、100% 代碼涵蓋率
   - 韌體：C 單元測試、100% 陳述句 + 分支涵蓋率
   - 範本：unit-test-spec.md
   - 工具：VCS/Questa (HW)、pytest/CUnit (FW)

3. **整合驗證 (ASPICE SWE.5, HWE.5)**
   - 測試組件互動
   - 驗證介面能正常運作
   - 範本：integration-test-spec.md

4. **系統驗證 (ASPICE SYS.4, SWE.6)**
   - 針對所有 SYS-REQ 測試系統
   - 資格認證測試驗證客戶需求
   - 範本：system-test-spec.md

5. **涵蓋率驗證**
   - 自動化可追蹤性檢查
   - ```powershell
     .\check-traceability.ps1 -Feature "001-feature-name" -Report
     .\check-requirements-coverage.ps1 -Feature "001-feature-name"
     ```
   - 目標：100% 的需求由測試涵蓋

**關鍵要求**：最終審查前不允許測試差距為零
- 每個 SYS-REQ 都必須有測試用例
- 每個測試都必須可追蹤到需求
- PR 中需要涵蓋率指標

**輸出**：
- 實施代碼 (RTL、C)
- unit-test-spec.md (帶結果)
- integration-test-spec.md (帶結果)
- system-test-spec.md (帶結果)
- 涵蓋率報告
- 代碼審查記錄

**審查關卡**：代碼審查 + 驗證審查
- 代碼審查檢查清單：
  - [ ] 遵循編碼標準 (MISRA C / SystemVerilog)
  - [ ] 可追蹤性標籤已存在
  - [ ] 同儕審查已完成
  - [ ] 涵蓋率可接受 (100% 陳述句/分支)
  - [ ] 無關鍵靜態分析違規
- 驗證審查檢查清單：
  - [ ] 所有測試通過
  - [ ] 涵蓋率指標可接受
  - [ ] 無孤立代碼
  - [ ] 需求已完整驗證
  - [ ] 缺陷已解決

---

### 第 6 階段：審查與批准 (2-3 天)

**目標**：在發佈前獲得利害關係人批准

**活動**：

1. **需求審查** (如果尚未批准)
   - 審查自初始批准以來的更改
   - 驗證仍然完整且一致

2. **設計審查** (如果尚未批准)
   - 審查來自安全性分析的設計修改
   - 驗證設計仍然解決所有需求

3. **最終驗證審查**
   - 所有測試通過 ✓
   - 涵蓋率完整 ✓
   - 可追蹤性完整 ✓
   - 安全性分析已解決 ✓
   - 所有缺陷已解決 ✓

4. **簽署**
   - 技術主管批准
   - 安全經理批准
   - 品質經理批准
   - 專案經理批准

**輸出**：
- 最終審查記錄 (在 review-records/ 目錄中)
- 已記錄的批准簽署
- 所有未解決問題已解決

---

### 第 7 階段：基線與發佈 (1 天)

**目標**：建立不可變的基線並準備部署

**活動**：

1. **版本化所有成品**
   - 凍結所有文檔
   - 在 Git 中標記代碼：`feature/001-v1.0`
   - 使用最終版本更新 change-log.md

2. **建立基線**
   ```bash
   git tag -a "001-power-loss-protection-v1.0" -m "Feature 001 release"
   ```

3. **歸檔用於產品生命週期**
   - 存儲在受控存儲庫
   - 連結到產品版本/組建
   - 記錄用於未來安全稽核

4. **準備發佈文檔**
   - 更改摘要
   - 可追蹤性矩陣 (最終版)
   - 安全性分析 (最終版)
   - 測試結果 (最終版)

**輸出**：
- 基線特性目錄
- Git 標籤用於發佈
- 發佈文檔套件
- 產品配置記錄

---

## 配置管理整合

### Git 工作流程

**分支命名**：
```
feature/[ID]-[short-name]
  範例：feature/001-power-loss-protection
```

**提交訊息** (包含需求/測試 ID)：
```
commit: TSR-HW-001-001 - 實施電源檢測器電路

- 檢測供應電壓下降 < 1ms
- 傳播延遲：850ns (< 1ms 需求)
- 用於容錯的冗餘比較器

引用：TSR-HW-001-001、TC-HW-001-001
```

**預提交鉤子**：
- 驗證代碼中存在可追蹤性標籤
- 檢查可追蹤性矩陣已更新
- 驗證提交訊息格式

**拉取請求檢查**：
- 自動化可追蹤性驗證
- 涵蓋率指標驗證
- 設計文檔審查

---

## 品質關卡與批准標準

| 關卡 | 標準 | 擁有者 | 證據 |
|------|------|--------|------|
| **初始化** | 範圍批准、ASIL 已分配 | 技術主管 | 特性啟動會議紀錄 |
| **需求** | 100% 可追蹤、利害關係人批准 | 需求主管 + 安全經理 | 簽署的需求審查 |
| **設計** | 涵蓋所有需求、DFT 已計劃 | 架構師 + 技術主管 | 簽署的設計審查 |
| **安全** | FMEA/FTA 完成、剩餘風險可接受 | 安全經理 | 簽署的安全性分析審查 |
| **實施** | 代碼已審查、100% 涵蓋率、零嚴重違規 | 技術主管 + 同儕 | 簽署的代碼審查 |
| **驗證** | 所有測試通過、可追蹤性完整 | 測試主管 + QA | 簽署的驗證審查 |
| **發佈** | 所有批准已獲得、已基線化 | PM + 安全經理 | Git 中標記的特性 |

---

## 開發期間的變更管理

### 當需求變更時

1. **影響分析**
   ```powershell
   .\check-change-impact.ps1 -File "requirements.md" -ChangeType "requirement"
   ```

2. **更新受影響的成品**
   - 受影響的設計文檔
   - 受影響的實施檔案
   - 受影響的測試用例

3. **獲得重新批准**
   - 需求審查 (如果發生重大變更)
   - 設計審查 (如果有設計影響)
   - 驗證審查 (如果有測試影響)

4. **更新變更日誌**
   - 記錄更改及其理由
   - 交叉引用受影響的需求
   - 記錄批准

### 當設計變更時

1. **驗證需求仍然得到滿足**
   - 根據 SYS-REQ/TSR 進行審查
   - 更新可追蹤性矩陣

2. **更新實施計劃**
   - 估計成本/進度影響
   - 識別被阻止的工作項

3. **重新執行受影響的測試**
   - 已變更模組的單元測試
   - 介面的整合測試
   - 迴歸測試套件

### 當實施變更時

1. **驗證設計規格準確性**
   - 代碼符合設計文檔

2. **更新代碼可追蹤性**
   - 新增/更新 @requirement 標籤
   - 確保完整可追蹤性

3. **重新執行驗證**
   - 已變更函式的單元測試
   - 涵蓋率重新測量
   - 迴歸測試

---

## 指標與報告

### 關鍵指標

**需求指標**：
- 總需求數：[計數]
- 按 ASIL 的需求：[A/B/C/D 細分]
- 按類型的需求：[功能/性能/介面]
- 需求波動性：[% 已變更]

**可追蹤性指標**：
- 正向涵蓋率：[% 具有設計/代碼/測試的需求]
- 反向涵蓋率：[% 可追蹤到需求的代碼]
- 涵蓋率差距：[無追蹤項目清單]
- 孤立項目：[無需求的代碼/測試]

**驗證指標**：
- 陳述句涵蓋率：[100% 目標]
- 分支涵蓋率：[ASIL-B 的 100% 目標]
- 功能涵蓋率：[% 測試的情景]
- 缺陷密度：[每 KLOC 的缺陷]

**進度指標**：
- 計畫與實際階段時間
- 里程碑達成率
- 返工百分比

### 報告

**每日站立會議** (簡短)：
- 完成了什麼
- 什麼被阻止
- 後續行動

**週狀態報告**：
- 階段進度
- 問題和風險
- 即將推進的里程碑

**階段關卡報告**：
- 關卡通過/失敗標準
- 符合的證據
- 批准/簽署

---

## 最佳實踐

✅ **應該做**：

1. **從需求開始** - 未經需求審查，切勿進行設計
2. **及早涉及安全** - 安全經理從第 1 階段起參與
3. **自動化可追蹤性** - 使用指令碼檢測差距
4. **記錄決策** - 捕捉"為什麼"而不僅僅是"什麼"
5. **及早測試** - 在實施前編寫測試
6. **持續審查** - 不要等到階段末期審查
7. **版本化所有內容** - 所有成品在 Git 中
8. **維護基線** - 在每個階段關卡進行基線化

❌ **不應該做**：

1. 不要跳過需求審查
2. 不要使用沒有可追蹤性標籤的代碼
3. 不要放棄涵蓋率目標
4. 不要跳過安全性分析 (FMEA/FTA/DFA)
5. 不要在未進行影響分析的情況下變更需求
6. 不要合併失敗驗證的代碼
7. 不要在未進行最終審查的情況下發佈
8. 不要忽視指標

---

## 故障排除

| 問題 | 原因 | 解決方案 |
|------|------|--------|
| 發現可追蹤性差距 | 需求未流向 TSR | 完成 TSR 配置流程 |
| 代碼沒有可追蹤性 | 開發人員忘記 @requirement 標籤 | 新增標籤、更新可追蹤性矩陣 |
| 測試涵蓋率 < 100% | 無法到達的代碼或缺少測試 | 正當化無法到達的代碼或新增測試 |
| 高 FMEA RPN | 設計減輕方案不足 | 重新設計或新增冗餘/監控 |
| 需求已變更 | 範圍蠕變 | 正式變更控制流程 |

---

## 工具和環境

**Git**：版本控制和分支
**Markdown**：需求和設計文檔
**PowerShell**：可追蹤性自動化指令碼
**涵蓋率工具**：VCS (HW)、pytest/gcov (FW)
**靜態分析**：Lint 工具 (Verilog)、clang-analyzer (C)

---

## 後續步驟

1. **閱讀**：[特性建立指南](FEATURE-CREATION-GUIDE.md)
2. **執行**：`.\create-feature.ps1` 以建立您的第一個特性
3. **遵循**：上述 7 階段流程
4. **驗證**：執行可追蹤性指令碼以檢查完整性
5. **審查**：在繼續前進行關卡審查

**有問題嗎？** 聯絡：流程所有者、技術主管或安全經理

---

**文檔版本**：1.0.0  
**最後更新**：2025-12-02  
**下次審查**：2026-03-02
